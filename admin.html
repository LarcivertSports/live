<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Yayın Yönetimi</title>
    <style>
        /* Stil kodları öncekiyle aynı, sadece en sona yeni kurallar eklendi */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f4f7f9; }
        h1, h2 { color: #333; }
        .form-container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input[type="text"], select { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 5px; }
        button:hover { opacity: 0.9; }
        .add-btn { background-color: #007bff; }
        .update-btn { background-color: #28a745; }
        .cancel-btn { background-color: #6c757d; }
        ul { list-style-type: none; padding: 0; }
        li { background-color: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .stream-info { display: flex; align-items: center; flex-grow: 1; margin-right: 10px; }
        .stream-info img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 15px; }
        .stream-actions button { font-size: 12px; padding: 5px 10px; }
        .stream-type { font-size: 12px; background-color: #e9ecef; color: #495057; padding: 3px 8px; border-radius: 10px; }
        .edit-btn { background-color: #ffc107; color: #212529; }
        .delete-btn { background-color: #dc3545; }
        /* YENİ: Header ve Çıkış Butonu için stiller */
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #logoutBtn { background-color: #6c757d; font-size: 14px; padding: 8px 12px; }
    </style>
</head>
<body>

    <div class="admin-header">
        <h1>Yayın Yönetim Paneli</h1>
        <div>
            <span id="welcomeMessage"></span>
            <button id="logoutBtn">Çıkış Yap</button>
        </div>
    </div>

    <div class="form-container">
        <h2 id="formTitle">Yeni Yayın Ekle</h2>
        <form id="streamForm">
            <input type="text" id="streamName" placeholder="Yayın Adı (Örn: Spor Kanalı)" required>
            <input type="text" id="streamUrl" placeholder="Yayın URL'si" required>
            <input type="text" id="logoUrl" placeholder="Kanal Logo URL'si (https://...)">
            <select id="streamType">
                <option value="hls">HLS (.m3u8)</option>
                <option value="iframe">Web Sayfası / Gömülebilir Link</option>
            </select>
            <div id="buttonGroup">
                <button type="submit" class="add-btn" id="addBtn">Yayını Ekle</button>
                <button type="submit" class="update-btn" id="updateBtn" style="display:none;">Yayını Güncelle</button>
                <button type="button" class="cancel-btn" id="cancelBtn" style="display:none;">İptal</button>
            </div>
        </form>
    </div>

    <h2>Mevcut Yayınlar</h2>
    <ul id="streamList"></ul>

    <script>
        // === YENİ: GİRİŞ KONTROLÜ (AUTH GUARD) ===
        // Bu kod, sayfanın geri kalanından önce çalışır.
        const loggedInUser = sessionStorage.getItem('loggedInUser');
        if (!loggedInUser) {
            // Eğer sessionStorage'da kullanıcı bilgisi yoksa, giriş sayfasına yönlendir.
            alert('Bu sayfayı görüntülemek için giriş yapmalısınız.');
            window.location.href = 'admin-giris.html';
        }
        // === GİRİŞ KONTROLÜ SONU ===


        // Sayfanın geri kalanındaki tüm JavaScript kodları aynı...
        const form = document.getElementById('streamForm');
        // ... (önceki admin.html'deki script'in tamamı buraya gelecek)
        const welcomeMessage = document.getElementById('welcomeMessage');
        const logoutBtn = document.getElementById('logoutBtn');

        // Hoşgeldin mesajını ayarla
        welcomeMessage.textContent = `Hoş geldin, ${loggedInUser}!`;
        
        // Çıkış butonuna tıklanınca
        logoutBtn.addEventListener('click', function() {
            sessionStorage.removeItem('loggedInUser'); // Oturum bilgisini sil
            window.location.href = 'admin-giris.html'; // Giriş sayfasına yönlendir
        });

        // Diğer tüm değişken ve fonksiyon tanımlamaları...
        const formTitle = document.getElementById('formTitle');
        const streamNameInput = document.getElementById('streamName');
        const streamUrlInput = document.getElementById('streamUrl');
        const logoUrlInput = document.getElementById('logoUrl');
        const streamTypeInput = document.getElementById('streamType');
        const streamList = document.getElementById('streamList');
        const addBtn = document.getElementById('addBtn');
        const updateBtn = document.getElementById('updateBtn');
        const cancelBtn = document.getElementById('cancelBtn');

        let editIndex = -1;
        let streams = JSON.parse(localStorage.getItem('streams')) || [];

        function saveAndRender() {
            localStorage.setItem('streams', JSON.stringify(streams));
            renderStreams();
        }

        function setFormMode(mode, index = -1) {
            if (mode === 'edit') {
                editIndex = index;
                const stream = streams[index];
                formTitle.textContent = "Yayını Düzenle";
                streamNameInput.value = stream.name;
                streamUrlInput.value = stream.url;
                logoUrlInput.value = stream.logoUrl || '';
                streamTypeInput.value = stream.type;
                addBtn.style.display = 'none';
                updateBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'inline-block';
            } else {
                editIndex = -1;
                formTitle.textContent = "Yeni Yayın Ekle";
                form.reset();
                addBtn.style.display = 'inline-block';
                updateBtn.style.display = 'none';
                cancelBtn.style.display = 'none';
            }
        }

        function renderStreams() {
            streamList.innerHTML = '';
            if (streams.length === 0) {
                streamList.innerHTML = '<li>Henüz yayın eklenmemiş.</li>';
                return;
            }
            streams.forEach((stream, index) => {
                const li = document.createElement('li');
                const logoPreview = stream.logoUrl ? `<img src="${stream.logoUrl}" alt="${stream.name} Logo">` : `<img src="https://via.placeholder.com/50" alt="Placeholder">`;
                li.innerHTML = `
                    <div class="stream-info">
                        ${logoPreview}
                        <div>
                            <strong>${stream.name}</strong> <span class="stream-type">${stream.type === 'iframe' ? 'Web Sayfası' : 'HLS'}</span><br>
                            <small>${stream.url}</small>
                        </div>
                    </div>
                    <div class="stream-actions">
                        <button class="edit-btn" data-index="${index}">Düzenle</button>
                        <button class="delete-btn" data-index="${index}">Sil</button>
                    </div>
                `;
                streamList.appendChild(li);
            });
        }

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const name = streamNameInput.value.trim();
            const url = streamUrlInput.value.trim();
            const logoUrl = logoUrlInput.value.trim();
            const type = streamTypeInput.value;
            if (!name || !url) return;
            const streamData = { name, url, logoUrl, type };
            if (editIndex === -1) {
                streams.push(streamData);
            } else {
                streams[editIndex] = streamData;
            }
            saveAndRender();
            setFormMode('add');
        });

        cancelBtn.addEventListener('click', () => setFormMode('add'));

        streamList.addEventListener('click', function (e) {
            const target = e.target;
            if (target.classList.contains('delete-btn')) {
                const index = target.getAttribute('data-index');
                if (confirm(`"${streams[index].name}" yayınını silmek istediğinizden emin misiniz?`)) {
                    streams.splice(index, 1);
                    saveAndRender();
                    if (index == editIndex) setFormMode('add');
                }
            } else if (target.classList.contains('edit-btn')) {
                const index = target.getAttribute('data-index');
                setFormMode('edit', parseInt(index));
            }
        });
        
        renderStreams();
    </script>

</body>
</html>
