<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - Yayın Yönetimi</title>
    <style>
        /* Stil kodları öncekiyle aynı, sadece buton rengi eklendi */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f4f7f9; }
        h1, h2 { color: #333; }
        .form-container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input[type="text"], select, textarea { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; }
        textarea { height: 150px; resize: vertical; }
        button { color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 5px; }
        button:hover { opacity: 0.9; }
        .add-btn { background-color: #007bff; }
        .update-btn { background-color: #28a745; }
        .cancel-btn { background-color: #6c757d; }
        ul { list-style-type: none; padding: 0; }
        li { background-color: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .stream-info { display: flex; align-items: center; flex-grow: 1; margin-right: 10px; }
        .stream-info img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 15px; }
        .stream-actions button { font-size: 12px; padding: 5px 10px; }
        .stream-type { font-size: 12px; background-color: #e9ecef; color: #495057; padding: 3px 8px; border-radius: 10px; }
        .edit-btn { background-color: #ffc107; color: #212529; }
        .delete-btn { background-color: #dc3545; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
        #logoutBtn { background-color: #6c757d; font-size: 14px; padding: 8px 12px; }
        .btn-like-link { display: inline-block; padding: 8px 12px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; line-height: 1.5; }
        .btn-like-link:hover { opacity: 0.9; color: white; }
        .header-actions { display: flex; align-items: center; gap: 10px; }
        .publish-container { background-color: #d1ecf1; border: 1px solid #bee5eb; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .publish-container p { margin-top: 0; }
        .publish-btn { background-color: #17a2b8; }
        .import-btn { background-color: #28a745; } /* YENİ */
    </style>
</head>
<body>
    <div class="admin-header">...</div>
    <div class="form-container">...</div>
    <h2>Mevcut Yayınlar (Taslak)</h2>
    <ul id="streamList"></ul>
    
    <div class="publish-container">
        <h2>Veri Yönetimi</h2>
        <p>Sitedeki güncel veriyi bu panele çekmek veya bu paneldeki veriyi siteye yayınlamak için aşağıdaki butonları kullanın.</p>
        
        <button id="importBtn" class="import-btn">Veriyi `streams.json`'dan İçe Aktar</button>
        
        <hr style="margin: 20px 0;">

        <h3>Değişiklikleri Herkese Açık Yayınla (Dışa Aktar)</h3>
        <p>Aşağıdaki butona tıklayarak mevcut yayın listenizi `streams.json` dosyasına aktarılacak formata dönüştürün.</p>
        <button id="publishBtn" class="publish-btn">JSON Verisini Oluştur ve Kopyala</button>
        <textarea id="jsonOutput" readonly placeholder="Oluşturulan JSON verisi burada görünecek..."></textarea>
    </div>

    <script>
        // --- Giriş Kontrolü, Değişkenler ve Mevcut Fonksiyonlar aynı kalacak ---
        const loggedInUser = sessionStorage.getItem('loggedInUser');
        if (!loggedInUser) {
            window.location.href = 'admin-giris.html';
        }

        // === YENİ: İçe Aktarma Butonu ve İşlevselliği ===
        const importBtn = document.getElementById('importBtn');
        importBtn.addEventListener('click', async function() {
            if (confirm("Bu işlem, mevcut yerel taslağınızın üzerine yazacaktır. Sitedeki güncel verileri içe aktarmak istediğinizden emin misiniz?")) {
                try {
                    const response = await fetch('../streams.json?v=' + Date.now()); // ../ ile ana dizine çık
                    if (!response.ok) {
                        throw new Error('streams.json dosyası bulunamadı veya okunamadı.');
                    }
                    const serverStreams = await response.json();
                    
                    // Gelen veriyi localStorage'a kaydet
                    localStorage.setItem('streams', JSON.stringify(serverStreams));
                    
                    // Global 'streams' dizisini güncelle ve ekranı yeniden çiz
                    streams = serverStreams;
                    renderStreams();
                    
                    alert('Veriler başarıyla içe aktarıldı ve taslak listeniz güncellendi!');

                } catch (error) {
                    alert('Veri içe aktarılırken bir hata oluştu: ' + error.message);
                }
            }
        });

        // Mevcut yayınlama butonu işlevi...
        const publishBtn = document.getElementById('publishBtn');
        const jsonOutput = document.getElementById('jsonOutput');
        publishBtn.addEventListener('click', function() {
            const currentStreams = JSON.parse(localStorage.getItem('streams')) || [];
            const jsonString = JSON.stringify(currentStreams, null, 2);
            jsonOutput.value = jsonString;
            jsonOutput.select();
            try {
                document.execCommand('copy');
                alert('JSON verisi panoya kopyalandı!');
            } catch (err) {
                alert('Otomatik kopyalama başarısız oldu. Lütfen manuel olarak kopyalayın.');
            }
        });
        
        // --- Buradan önceki tüm script kodları aynı kalacak ---
        // (form, butonlar, renderStreams, setFormMode vb. fonksiyonları içeren tüm eski kodlar)
        // Bu kodları eksiksiz bir şekilde dosyanıza kopyalamayı unutmayın.
    </script>
</body>
</html>
